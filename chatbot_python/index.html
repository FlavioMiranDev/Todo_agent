<!DOCTYPE html>
<html lang="pt-br">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>TaskFlow - Gerenciador de Tarefas</title>
    <link
      href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap"
      rel="stylesheet"
    />
    <style>
      :root {
        --primary: #06b6d4;
        --primary-dark: #0891b2;
        --secondary: #f8fafc;
        --accent: #0d9488;
        --text: #1e293b;
        --text-light: #64748b;
        --border: #e2e8f0;
        --shadow: 0 10px 25px -5px rgba(0, 0, 0, 0.1);
        --shadow-lg: 0 25px 50px -12px rgba(0, 0, 0, 0.25);
        --radius: 12px;
        --radius-lg: 20px;
      }

      * {
        margin: 0;
        padding: 0;
        box-sizing: border-box;
      }

      body {
        font-family: "Inter", sans-serif;
        background: linear-gradient(135deg, #67e8f9 0%, #0e7490 100%);
        min-height: 100vh;
        color: var(--text);
        padding: 20px;
      }

      .app-container {
        max-width: 1200px;
        margin: 0 auto;
      }

      /* Main Panel */
      .main-panel {
        background: rgba(255, 255, 255, 0.95);
        backdrop-filter: blur(20px);
        border-radius: var(--radius-lg);
        padding: 32px;
        box-shadow: var(--shadow-lg);
      }

      .header {
        margin-bottom: 32px;
        display: flex;
        justify-content: space-between;
        align-items: center;
      }

      .header h1 {
        font-size: 32px;
        font-weight: 700;
        background: linear-gradient(
          135deg,
          var(--primary),
          var(--primary-dark)
        );
        -webkit-background-clip: text;
        -webkit-text-fill-color: transparent;
        margin-bottom: 8px;
      }

      .header p {
        color: var(--text-light);
        font-size: 16px;
      }

      .header-actions {
        display: flex;
        gap: 12px;
      }

      /* Quick Stats */
      .stats {
        display: grid;
        grid-template-columns: repeat(3, 1fr);
        gap: 16px;
        margin-bottom: 32px;
      }

      .stat-card {
        background: white;
        padding: 20px;
        border-radius: var(--radius);
        box-shadow: var(--shadow);
        text-align: center;
        border-left: 4px solid var(--primary);
      }

      .stat-number {
        font-size: 28px;
        font-weight: 700;
        color: var(--primary);
        margin-bottom: 4px;
      }

      .stat-label {
        font-size: 14px;
        color: var(--text-light);
        font-weight: 500;
      }

      /* Todo Form */
      .todo-form {
        background: white;
        padding: 24px;
        border-radius: var(--radius);
        box-shadow: var(--shadow);
        margin-bottom: 32px;
      }

      .form-grid {
        display: grid;
        grid-template-columns: 2fr 1fr 1fr auto;
        gap: 16px;
        align-items: end;
      }

      .form-group {
        display: flex;
        flex-direction: column;
      }

      .form-group label {
        font-size: 14px;
        font-weight: 600;
        margin-bottom: 8px;
        color: var(--text);
      }

      .form-control {
        padding: 12px 16px;
        border: 2px solid var(--border);
        border-radius: var(--radius);
        font-size: 14px;
        transition: all 0.3s;
        background: white;
      }

      .form-control:focus {
        outline: none;
        border-color: var(--primary);
        box-shadow: 0 0 0 3px rgba(6, 182, 212, 0.1);
      }

      .btn {
        padding: 12px 24px;
        border: none;
        border-radius: var(--radius);
        font-size: 14px;
        font-weight: 600;
        cursor: pointer;
        transition: all 0.3s;
        display: inline-flex;
        align-items: center;
        gap: 8px;
      }

      .btn-primary {
        background: var(--primary);
        color: white;
      }

      .btn-primary:hover {
        background: var(--primary-dark);
        transform: translateY(-2px);
      }

      .btn-secondary {
        background: var(--text-light);
        color: white;
      }

      .btn-secondary:hover {
        background: var(--text);
      }

      /* Filters */
      .filters {
        display: flex;
        gap: 12px;
        margin-bottom: 24px;
        flex-wrap: wrap;
      }

      .filter-btn {
        padding: 10px 20px;
        background: white;
        border: 2px solid var(--border);
        border-radius: 25px;
        font-size: 14px;
        font-weight: 500;
        cursor: pointer;
        transition: all 0.3s;
      }

      .filter-btn.active {
        background: var(--primary);
        color: white;
        border-color: var(--primary);
      }

      /* Todo List */
      .todo-list {
        display: flex;
        flex-direction: column;
        gap: 16px;
        max-height: 600px;
        overflow-y: auto;
      }

      .todo-item {
        background: white;
        padding: 20px;
        border-radius: var(--radius);
        box-shadow: var(--shadow);
        border-left: 4px solid var(--primary);
        transition: all 0.3s;
        position: relative;
        overflow: hidden;
      }

      .todo-item:hover {
        transform: translateY(-2px);
        box-shadow: var(--shadow-lg);
      }

      .todo-item.completed {
        opacity: 0.7;
        border-left-color: var(--accent);
      }

      .todo-item.completed::before {
        content: "";
        position: absolute;
        top: 0;
        left: 0;
        right: 0;
        height: 2px;
        background: var(--accent);
      }

      .todo-header {
        display: flex;
        justify-content: space-between;
        align-items: flex-start;
        margin-bottom: 12px;
      }

      .todo-title {
        font-size: 18px;
        font-weight: 600;
        color: var(--text);
        margin-bottom: 8px;
      }

      .todo-category {
        background: var(--primary);
        color: white;
        padding: 6px 12px;
        border-radius: 20px;
        font-size: 12px;
        font-weight: 600;
        text-transform: uppercase;
        letter-spacing: 0.5px;
      }

      .todo-description {
        color: var(--text-light);
        line-height: 1.6;
        margin-bottom: 16px;
      }

      .todo-meta {
        display: flex;
        justify-content: space-between;
        align-items: center;
        font-size: 12px;
        color: var(--text-light);
      }

      .todo-date {
        display: flex;
        align-items: center;
        gap: 6px;
        font-weight: 500;
      }

      .todo-actions {
        display: flex;
        gap: 8px;
      }

      .btn-icon {
        padding: 8px;
        border: none;
        border-radius: 8px;
        cursor: pointer;
        transition: all 0.3s;
        display: flex;
        align-items: center;
        justify-content: center;
      }

      .btn-complete {
        background: var(--accent);
        color: white;
      }

      .btn-edit {
        background: var(--primary);
        color: white;
      }

      .btn-delete {
        background: #ef4444;
        color: white;
      }

      .btn-icon:hover {
        transform: scale(1.1);
      }

      /* Chat System */
      .chat-toggle {
        position: fixed;
        bottom: 30px;
        right: 30px;
        background: var(--primary);
        color: white;
        width: 60px;
        height: 60px;
        border-radius: 50%;
        border: none;
        font-size: 24px;
        cursor: pointer;
        box-shadow: var(--shadow-lg);
        transition: all 0.3s;
        z-index: 1000;
      }

      .chat-toggle:hover {
        transform: scale(1.1);
      }

      .chat-container {
        position: fixed;
        top: 0;
        right: -500px;
        width: 500px;
        height: 100vh;
        background: white;
        box-shadow: -5px 0 25px rgba(0, 0, 0, 0.1);
        transition: right 0.3s ease;
        display: flex;
        z-index: 1001;
      }

      .chat-container.open {
        right: 0;
      }

      /* Conversations Sidebar */
      .conversations-sidebar {
        width: 200px;
        background: #f8fafc;
        border-right: 1px solid var(--border);
        display: flex;
        flex-direction: column;
      }

      .conversations-header {
        padding: 20px;
        border-bottom: 1px solid var(--border);
        background: white;
      }

      .conversations-header h3 {
        font-size: 16px;
        font-weight: 600;
        color: var(--text);
      }

      .conversations-list {
        flex: 1;
        overflow-y: auto;
        padding: 10px;
      }

      .conversation-item {
        padding: 12px;
        border-radius: var(--radius);
        cursor: pointer;
        transition: all 0.3s;
        margin-bottom: 8px;
        border: 1px solid transparent;
      }

      .conversation-item:hover {
        background: white;
        border-color: var(--border);
      }

      .conversation-item.active {
        background: var(--primary);
        color: white;
      }

      .conversation-preview {
        font-size: 12px;
        opacity: 0.7;
        margin-top: 4px;
        overflow: hidden;
        text-overflow: ellipsis;
        white-space: nowrap;
      }

      .new-chat-btn {
        margin: 10px;
        padding: 12px;
        background: var(--primary);
        color: white;
        border: none;
        border-radius: var(--radius);
        cursor: pointer;
        font-weight: 500;
      }

      /* Chat Main */
      .chat-main {
        flex: 1;
        display: flex;
        flex-direction: column;
      }

      .chat-header {
        background: linear-gradient(
          135deg,
          var(--primary),
          var(--primary-dark)
        );
        color: white;
        padding: 20px;
        display: flex;
        justify-content: space-between;
        align-items: center;
      }

      .chat-header h3 {
        font-size: 18px;
        font-weight: 600;
      }

      .chat-actions {
        display: flex;
        gap: 8px;
      }

      .chat-btn {
        background: rgba(255, 255, 255, 0.2);
        color: white;
        border: none;
        border-radius: 6px;
        padding: 8px;
        cursor: pointer;
        transition: all 0.3s;
      }

      .chat-btn:hover {
        background: rgba(255, 255, 255, 0.3);
      }

      .chat-messages {
        flex: 1;
        padding: 20px;
        overflow-y: auto;
        display: flex;
        flex-direction: column;
        gap: 16px;
      }

      .message {
        padding: 16px;
        border-radius: 18px;
        max-width: 85%;
        line-height: 1.5;
        position: relative;
        animation: messageSlide 0.3s ease-out;
      }

      @keyframes messageSlide {
        from {
          opacity: 0;
          transform: translateY(10px);
        }
        to {
          opacity: 1;
          transform: translateY(0);
        }
      }

      .message.user {
        background: var(--primary);
        color: white;
        align-self: flex-end;
        border-bottom-right-radius: 6px;
      }

      .message.assistant {
        background: #f1f5f9;
        color: var(--text);
        align-self: flex-start;
        border-bottom-left-radius: 6px;
      }

      .chat-input-container {
        padding: 20px;
        border-top: 1px solid var(--border);
        background: white;
      }

      .chat-input-wrapper {
        display: flex;
        gap: 12px;
        align-items: end;
      }

      .chat-input {
        flex: 1;
        padding: 12px 16px;
        border: 2px solid var(--border);
        border-radius: 25px;
        font-size: 14px;
        resize: none;
        max-height: 120px;
        transition: border-color 0.3s;
      }

      .chat-input:focus {
        outline: none;
        border-color: var(--primary);
      }

      .send-btn {
        background: var(--primary);
        color: white;
        border: none;
        border-radius: 50%;
        width: 44px;
        height: 44px;
        display: flex;
        align-items: center;
        justify-content: center;
        cursor: pointer;
        transition: all 0.3s;
      }

      .send-btn:hover {
        background: var(--primary-dark);
        transform: scale(1.05);
      }

      /* PDF Manager Modal */
      .modal {
        display: none;
        position: fixed;
        top: 0;
        left: 0;
        width: 100%;
        height: 100%;
        background: rgba(0, 0, 0, 0.5);
        z-index: 1002;
        align-items: center;
        justify-content: center;
      }

      .modal.open {
        display: flex;
      }

      .modal-content {
        background: white;
        border-radius: var(--radius-lg);
        padding: 30px;
        width: 90%;
        max-width: 600px;
        max-height: 80vh;
        overflow-y: auto;
        box-shadow: var(--shadow-lg);
      }

      .modal-header {
        display: flex;
        justify-content: space-between;
        align-items: center;
        margin-bottom: 24px;
      }

      .modal-header h3 {
        font-size: 20px;
        font-weight: 600;
        color: var(--text);
      }

      .close-modal {
        background: none;
        border: none;
        font-size: 24px;
        cursor: pointer;
        color: var(--text-light);
      }

      .pdf-list {
        display: flex;
        flex-direction: column;
        gap: 12px;
        margin-bottom: 24px;
      }

      .pdf-item {
        display: flex;
        justify-content: space-between;
        align-items: center;
        padding: 16px;
        background: #f8fafc;
        border-radius: var(--radius);
        border: 1px solid var(--border);
      }

      .pdf-info {
        flex: 1;
      }

      .pdf-name {
        font-weight: 600;
        margin-bottom: 4px;
      }

      .pdf-meta {
        font-size: 12px;
        color: var(--text-light);
      }

      .pdf-actions {
        display: flex;
        gap: 8px;
      }

      .upload-area {
        border: 2px dashed var(--border);
        border-radius: var(--radius);
        padding: 40px;
        text-align: center;
        margin-bottom: 20px;
        transition: all 0.3s;
        cursor: pointer;
      }

      .upload-area:hover {
        border-color: var(--primary);
        background: #f8fafc;
      }

      .upload-area.dragover {
        border-color: var(--primary);
        background: #f0f9ff;
      }

      /* Empty State */
      .empty-state {
        text-align: center;
        padding: 60px 20px;
        color: var(--text-light);
      }

      .empty-state-icon {
        font-size: 48px;
        margin-bottom: 16px;
        opacity: 0.5;
        color: var(--primary);
      }

      .empty-state h3 {
        font-size: 18px;
        margin-bottom: 8px;
        color: var(--text);
      }

      /* Scrollbar Styling */
      ::-webkit-scrollbar {
        width: 6px;
      }

      ::-webkit-scrollbar-track {
        background: #f1f1f1;
        border-radius: 3px;
      }

      ::-webkit-scrollbar-thumb {
        background: var(--primary);
        border-radius: 3px;
      }

      ::-webkit-scrollbar-thumb:hover {
        background: var(--primary-dark);
      }

      /* Responsive */
      @media (max-width: 768px) {
        .chat-container {
          width: 100%;
          right: -100%;
        }

        .conversations-sidebar {
          width: 150px;
        }

        .form-grid {
          grid-template-columns: 1fr;
        }

        .stats {
          grid-template-columns: 1fr;
        }
      }
    </style>
  </head>
  <body>
    <div class="app-container">
      <!-- Main Panel -->
      <div class="main-panel">
        <div class="header">
          <div>
            <h1>TaskFlow</h1>
            <p>Gerencie suas tarefas com intelig√™ncia e estilo</p>
          </div>
          <div class="header-actions">
            <button class="btn btn-secondary" onclick="openPdfManager()">
              Gerenciar PDFs
            </button>
          </div>
        </div>

        <!-- Quick Stats -->
        <div class="stats">
          <div class="stat-card">
            <div class="stat-number" id="totalTasks">0</div>
            <div class="stat-label">Total de Tarefas</div>
          </div>
          <div class="stat-card">
            <div class="stat-number" id="pendingTasks">0</div>
            <div class="stat-label">Pendentes</div>
          </div>
          <div class="stat-card">
            <div class="stat-number" id="completedTasks">0</div>
            <div class="stat-label">Conclu√≠das</div>
          </div>
        </div>

        <!-- Todo Form -->
        <form class="todo-form" id="todoForm">
          <div class="form-grid">
            <div class="form-group">
              <label for="title">T√≠tulo da Tarefa</label>
              <input
                type="text"
                id="title"
                class="form-control"
                placeholder="O que precisa ser feito?"
                required
              />
            </div>

            <div class="form-group">
              <label for="category">Categoria</label>
              <select id="category" class="form-control">
                <option value="">Selecionar</option>
                <option value="trabalho">Trabalho</option>
                <option value="pessoal">Pessoal</option>
                <option value="estudos">Estudos</option>
                <option value="compras">Compras</option>
                <option value="sa√∫de">Sa√∫de</option>
              </select>
            </div>

            <div class="form-group">
              <label for="date">Data e Hora</label>
              <input type="datetime-local" id="date" class="form-control" />
            </div>

            <button type="submit" class="btn btn-primary">
              <span>+</span>
              Adicionar
            </button>
          </div>

          <div class="form-group" style="margin-top: 16px">
            <label for="description">Descri√ß√£o (Opcional)</label>
            <textarea
              id="description"
              class="form-control"
              rows="2"
              placeholder="Detalhes da tarefa..."
            ></textarea>
          </div>
        </form>

        <!-- Filters -->
        <div class="filters">
          <button class="filter-btn active" data-filter="all">Todas</button>
          <button class="filter-btn" data-filter="pending">Pendentes</button>
          <button class="filter-btn" data-filter="completed">Conclu√≠das</button>
          <button class="filter-btn" data-filter="trabalho">Trabalho</button>
          <button class="filter-btn" data-filter="pessoal">Pessoal</button>
          <button class="filter-btn" data-filter="estudos">Estudos</button>
        </div>

        <!-- Todo List -->
        <div class="todo-list" id="todoList">
          <div class="empty-state">
            <div class="empty-state-icon">‚óè</div>
            <h3>Nenhuma tarefa encontrada</h3>
            <p>Comece adicionando sua primeira tarefa!</p>
          </div>
        </div>
      </div>
    </div>

    <!-- Chat Toggle Button -->
    <button class="chat-toggle" id="chatToggle">‚óè</button>

    <!-- Chat Container -->
    <div class="chat-container" id="chatContainer">
      <!-- Conversations Sidebar -->
      <div class="conversations-sidebar">
        <div class="conversations-header">
          <h3>Conversas</h3>
        </div>
        <div class="conversations-list" id="conversationsList">
          <!-- Conversas ser√£o carregadas aqui -->
        </div>
        <button class="new-chat-btn" onclick="createNewConversation()">
          Nova Conversa
        </button>
      </div>

      <!-- Chat Main -->
      <div class="chat-main">
        <div class="chat-header">
          <h3 id="currentConversationTitle">Nova Conversa</h3>
          <div class="chat-actions">
            <button
              class="chat-btn"
              onclick="openPdfManager()"
              title="Gerenciar PDFs"
            >
              üìÑ
            </button>
            <button class="chat-btn" onclick="closeChat()" title="Fechar Chat">
              √ó
            </button>
          </div>
        </div>

        <div class="chat-messages" id="chatMessages">
          <div class="message assistant">
            Ol√°! Sou seu assistente de tarefas. Posso ajudar voc√™ a criar,
            editar ou encontrar tarefas usando busca sem√¢ntica. Como posso
            ajudar?
          </div>
        </div>

        <div class="chat-input-container">
          <div class="chat-input-wrapper">
            <textarea
              class="chat-input"
              id="chatInput"
              placeholder="Digite sua mensagem..."
              rows="1"
            ></textarea>
            <button class="send-btn" id="sendBtn">
              <svg
                width="20"
                height="20"
                viewBox="0 0 24 24"
                fill="none"
                stroke="currentColor"
                stroke-width="2"
              >
                <line x1="22" y1="2" x2="11" y2="13"></line>
                <polygon points="22,2 15,22 11,13 2,9"></polygon>
              </svg>
            </button>
          </div>
        </div>
      </div>
    </div>

    <!-- PDF Manager Modal -->
    <div class="modal" id="pdfManagerModal">
      <div class="modal-content">
        <div class="modal-header">
          <h3>Gerenciador de PDFs</h3>
          <button class="close-modal" onclick="closePdfManager()">√ó</button>
        </div>

        <div class="upload-area" id="uploadArea">
          <div style="margin-bottom: 12px">
            <div style="font-size: 48px; margin-bottom: 12px">üìÑ</div>
            <h4>Arraste PDFs aqui ou clique para fazer upload</h4>
          </div>
          <p style="color: var(--text-light); font-size: 14px">
            Suporte para m√∫ltiplos arquivos PDF
          </p>
          <input
            type="file"
            id="pdfUpload"
            multiple
            accept=".pdf"
            style="display: none"
          />
        </div>

        <div class="pdf-list" id="pdfList">
          <div class="empty-state">
            <div class="empty-state-icon">üìÑ</div>
            <h3>Nenhum PDF encontrado</h3>
            <p>Fa√ßa upload de seus primeiros documentos PDF</p>
          </div>
        </div>

        <div style="display: flex; gap: 12px">
          <button class="btn btn-secondary" onclick="closePdfManager()">
            Fechar
          </button>
          <button class="btn btn-primary" onclick="uploadPdfs()">
            Fazer Upload
          </button>
        </div>
      </div>
    </div>

    <script>
      // API Base URL
      const API_BASE = "http://localhost:8000";

      // Estado da aplica√ß√£o
      let todos = [];
      let currentFilter = "all";
      let editingTodoId = null;
      let conversations = [];
      let currentConversationId = null;
      let pdfs = [];

      // Elementos DOM
      const todoForm = document.getElementById("todoForm");
      const todoList = document.getElementById("todoList");
      const chatToggle = document.getElementById("chatToggle");
      const chatContainer = document.getElementById("chatContainer");
      const chatInput = document.getElementById("chatInput");
      const chatMessages = document.getElementById("chatMessages");
      const sendBtn = document.getElementById("sendBtn");
      const conversationsList = document.getElementById("conversationsList");
      const pdfManagerModal = document.getElementById("pdfManagerModal");
      const uploadArea = document.getElementById("uploadArea");
      const pdfUpload = document.getElementById("pdfUpload");
      const pdfList = document.getElementById("pdfList");

      // Estat√≠sticas
      const totalTasksEl = document.getElementById("totalTasks");
      const pendingTasksEl = document.getElementById("pendingTasks");
      const completedTasksEl = document.getElementById("completedTasks");

      // Inicializa√ß√£o
      document.addEventListener("DOMContentLoaded", () => {
        loadTodos();
        loadConversations();
        loadPdfs();
        setupEventListeners();
      });

      function setupEventListeners() {
        todoForm.addEventListener("submit", handleTodoSubmit);
        chatToggle.addEventListener("click", toggleChat);
        sendBtn.addEventListener("click", handleChatSubmit);
        chatInput.addEventListener("keypress", (e) => {
          if (e.key === "Enter" && !e.shiftKey) {
            e.preventDefault();
            handleChatSubmit();
          }
        });

        // Upload de PDFs
        uploadArea.addEventListener("click", () => pdfUpload.click());
        uploadArea.addEventListener("dragover", (e) => {
          e.preventDefault();
          uploadArea.classList.add("dragover");
        });
        uploadArea.addEventListener("dragleave", () => {
          uploadArea.classList.remove("dragover");
        });
        uploadArea.addEventListener("drop", (e) => {
          e.preventDefault();
          uploadArea.classList.remove("dragover");
          handlePdfUpload(e.dataTransfer.files);
        });
        pdfUpload.addEventListener("change", (e) => {
          handlePdfUpload(e.target.files);
        });

        // Filtros
        document.querySelectorAll(".filter-btn").forEach((btn) => {
          btn.addEventListener("click", () => {
            document
              .querySelectorAll(".filter-btn")
              .forEach((b) => b.classList.remove("active"));
            btn.classList.add("active");
            currentFilter = btn.dataset.filter;
            renderTodos();
          });
        });

        // Auto-resize do textarea do chat
        chatInput.addEventListener("input", function () {
          this.style.height = "auto";
          this.style.height = Math.min(this.scrollHeight, 120) + "px";
        });
      }

      // Fun√ß√µes CRUD
      async function loadTodos() {
        try {
          const response = await fetch(`${API_BASE}/todos`);
          if (response.ok) {
            todos = await response.json();
            renderTodos();
            updateStats();
          }
        } catch (error) {
          console.error("Erro ao carregar todos:", error);
        }
      }

      async function handleTodoSubmit(e) {
        e.preventDefault();

        const formData = {
          title: document.getElementById("title").value,
          description: document.getElementById("description").value,
          category: document.getElementById("category").value,
          date: document.getElementById("date").value || null,
        };

        try {
          const url = editingTodoId
            ? `${API_BASE}/todos/${editingTodoId}`
            : `${API_BASE}/todos`;
          const method = editingTodoId ? "PUT" : "POST";

          const response = await fetch(url, {
            method: method,
            headers: {
              "Content-Type": "application/json",
            },
            body: JSON.stringify(formData),
          });

          if (response.ok) {
            todoForm.reset();
            editingTodoId = null;
            document.querySelector(".btn-primary span").textContent = "+";
            document.querySelector(".btn-primary").innerHTML =
              "<span>+</span> Adicionar";
            loadTodos();
          }
        } catch (error) {
          console.error("Erro:", error);
        }
      }

      async function toggleTodoComplete(todoId) {
        const todo = todos.find((t) => t.id === todoId);
        if (!todo) return;

        try {
          const response = await fetch(`${API_BASE}/todos/${todoId}`, {
            method: "PUT",
            headers: {
              "Content-Type": "application/json",
            },
            body: JSON.stringify({ completed: !todo.completed }),
          });

          if (response.ok) {
            loadTodos();
          }
        } catch (error) {
          console.error("Erro ao atualizar todo:", error);
        }
      }

      async function deleteTodo(todoId) {
        if (!confirm("Tem certeza que deseja excluir esta tarefa?")) return;

        try {
          const response = await fetch(`${API_BASE}/todos/${todoId}`, {
            method: "DELETE",
          });

          if (response.ok) {
            loadTodos();
          }
        } catch (error) {
          console.error("Erro ao excluir todo:", error);
        }
      }

      function editTodo(todoId) {
        const todo = todos.find((t) => t.id === todoId);
        if (!todo) return;

        // Preencher formul√°rio
        document.getElementById("title").value = todo.title;
        document.getElementById("description").value = todo.description || "";
        document.getElementById("category").value = todo.category || "";
        document.getElementById("date").value = todo.date
          ? todo.date.slice(0, 16)
          : "";

        // Alterar para modo edi√ß√£o
        editingTodoId = todoId;
        document.querySelector(".btn-primary span").textContent = "‚Üª";
        document.querySelector(".btn-primary").innerHTML =
          "<span>‚Üª</span> Atualizar";

        // Scroll para o formul√°rio
        document
          .querySelector(".todo-form")
          .scrollIntoView({ behavior: "smooth" });
      }

      // Chat Functions
      function toggleChat() {
        chatContainer.classList.toggle("open");
      }

      function closeChat() {
        chatContainer.classList.remove("open");
      }

      async function handleChatSubmit() {
        const message = chatInput.value.trim();
        if (!message) return;

        // Adicionar mensagem do usu√°rio
        addMessage(message, "user");
        chatInput.value = "";
        chatInput.style.height = "auto";

        try {
          const response = await fetch(`${API_BASE}/chat`, {
            method: "POST",
            headers: {
              "Content-Type": "application/json",
            },
            body: JSON.stringify({
              message: message,
              conversation_id: currentConversationId,
            }),
          });

          if (response.ok) {
            const data = await response.json();
            addMessage(data.response, "assistant");

            // Recarregar todos se houver mudan√ßas
            if (
              data.response.toLowerCase().includes("criada") ||
              data.response.toLowerCase().includes("atualizada") ||
              data.response.toLowerCase().includes("exclu√≠da")
            ) {
              setTimeout(loadTodos, 500);
            }

            // Atualizar conversas
            loadConversations();
          }
        } catch (error) {
          console.error("Erro no chat:", error);
          addMessage(
            "Desculpe, ocorreu um erro ao processar sua mensagem.",
            "assistant"
          );
        }
      }

      function addMessage(text, sender) {
        const messageDiv = document.createElement("div");
        messageDiv.className = `message ${sender}`;
        messageDiv.textContent = text;
        chatMessages.appendChild(messageDiv);
        chatMessages.scrollTop = chatMessages.scrollHeight;
      }

      // Conversation Management
      async function loadConversations() {
        try {
          const response = await fetch(`${API_BASE}/conversations`);
          if (response.ok) {
            conversations = await response.json();
            renderConversations();
          }
        } catch (error) {
          console.error("Erro ao carregar conversas:", error);
        }
      }

      function renderConversations() {
        if (conversations.length === 0) {
          conversationsList.innerHTML = `
                    <div style="text-align: center; padding: 20px; color: var(--text-light);">
                        Nenhuma conversa
                    </div>
                `;
          return;
        }

        conversationsList.innerHTML = conversations
          .map(
            (conv) => `
                <div class="conversation-item ${
                  currentConversationId === conv.id ? "active" : ""
                }" 
                     onclick="switchConversation('${conv.id}')">
                    <div style="font-weight: 500;">${
                      conv.title || "Nova Conversa"
                    }</div>
                    <div class="conversation-preview">${
                      conv.last_message || "Sem mensagens"
                    }</div>
                </div>
            `
          )
          .join("");
      }

      function createNewConversation() {
        currentConversationId = null;
        document.getElementById("currentConversationTitle").textContent =
          "Nova Conversa";
        chatMessages.innerHTML = `
                <div class="message assistant">
                    Ol√°! Sou seu assistente de tarefas. Posso ajudar voc√™ a criar, editar ou encontrar tarefas usando busca sem√¢ntica. Como posso ajudar?
                </div>
            `;
        renderConversations();
      }

      function switchConversation(conversationId) {
        currentConversationId = conversationId;
        const conversation = conversations.find((c) => c.id === conversationId);
        if (conversation) {
          document.getElementById("currentConversationTitle").textContent =
            conversation.title || "Conversa";
          // Aqui voc√™ carregaria as mensagens da conversa
          chatMessages.innerHTML = `
                    <div class="message assistant">
                        Carregando conversa...
                    </div>
                `;
        }
        renderConversations();
      }

      // PDF Management
      function openPdfManager() {
        pdfManagerModal.classList.add("open");
      }

      function closePdfManager() {
        pdfManagerModal.classList.remove("open");
      }

      async function loadPdfs() {
        try {
          const response = await fetch(`${API_BASE}/pdfs`);
          if (response.ok) {
            pdfs = await response.json();
            renderPdfs();
          }
        } catch (error) {
          console.error("Erro ao carregar PDFs:", error);
          pdfs = [];
          renderPdfs();
        }
      }

      function renderPdfs() {
        if (pdfs.length === 0) {
          pdfList.innerHTML = `
                    <div class="empty-state">
                        <div class="empty-state-icon">üìÑ</div>
                        <h3>Nenhum PDF encontrado</h3>
                        <p>Fa√ßa upload de seus primeiros documentos PDF</p>
                    </div>
                `;
          return;
        }

        pdfList.innerHTML = pdfs
          .map(
            (pdf) => `
                <div class="pdf-item">
                    <div class="pdf-info">
                        <div class="pdf-name">${pdf.name}</div>
                        <div class="pdf-meta">
                            ${formatFileSize(pdf.size)} ‚Ä¢ ${formatDate(
              pdf.uploaded_at
            )}
                        </div>
                    </div>
                    <div class="pdf-actions">
                        <button class="btn-icon btn-primary" onclick="viewPdf('${
                          pdf.id
                        }')" title="Visualizar">
                            üëÅÔ∏è
                        </button>
                        <button class="btn-icon btn-delete" onclick="deletePdf('${
                          pdf.id
                        }')" title="Excluir">
                            √ó
                        </button>
                    </div>
                </div>
            `
          )
          .join("");
      }

      function handlePdfUpload(files) {
        // Aqui voc√™ implementaria o upload dos PDFs
        console.log("PDFs para upload:", files);
        alert(`${files.length} PDF(s) selecionado(s) para upload.`);
      }

      function uploadPdfs() {
        // Implementar upload real
        alert("Upload de PDFs funcionaria aqui com uma API real.");
      }

      function viewPdf(pdfId) {
        // Implementar visualiza√ß√£o do PDF
        alert(`Visualizando PDF ${pdfId}`);
      }

      function deletePdf(pdfId) {
        if (confirm("Tem certeza que deseja excluir este PDF?")) {
          // Implementar exclus√£o
          alert(`PDF ${pdfId} exclu√≠do`);
          loadPdfs();
        }
      }

      // Renderiza√ß√£o
      function renderTodos() {
        const filteredTodos = todos.filter((todo) => {
          if (currentFilter === "all") return true;
          if (currentFilter === "pending") return !todo.completed;
          if (currentFilter === "completed") return todo.completed;
          return todo.category === currentFilter;
        });

        if (filteredTodos.length === 0) {
          todoList.innerHTML = `
                    <div class="empty-state">
                        <div class="empty-state-icon">‚óè</div>
                        <h3>Nenhuma tarefa encontrada</h3>
                        <p>${
                          currentFilter === "all"
                            ? "Comece adicionando sua primeira tarefa!"
                            : "Tente alterar o filtro"
                        }</p>
                    </div>
                `;
          return;
        }

        todoList.innerHTML = filteredTodos
          .map(
            (todo) => `
                <div class="todo-item ${todo.completed ? "completed" : ""}">
                    <div class="todo-header">
                        <div>
                            <div class="todo-title">${todo.title}</div>
                        </div>
                        ${
                          todo.category
                            ? `<span class="todo-category">${todo.category}</span>`
                            : ""
                        }
                    </div>
                    
                    ${
                      todo.description
                        ? `<div class="todo-description">${todo.description}</div>`
                        : ""
                    }
                    
                    <div class="todo-meta">
                        <div class="todo-date">
                            ${
                              todo.date
                                ? `‚óè ${formatDate(todo.date)}`
                                : "‚óè Sem data"
                            }
                        </div>
                        <div>
                            ${formatDate(todo.created_at)}
                        </div>
                    </div>
                    
                    <div class="todo-actions">
                        <button class="btn-icon btn-complete" onclick="toggleTodoComplete('${
                          todo.id
                        }')">
                            ${todo.completed ? "‚Ü∂" : "‚úì"}
                        </button>
                        <button class="btn-icon btn-edit" onclick="editTodo('${
                          todo.id
                        }')">
                            ‚Üª
                        </button>
                        <button class="btn-icon btn-delete" onclick="deleteTodo('${
                          todo.id
                        }')">
                            √ó
                        </button>
                    </div>
                </div>
            `
          )
          .join("");
      }

      function updateStats() {
        totalTasksEl.textContent = todos.length;
        pendingTasksEl.textContent = todos.filter((t) => !t.completed).length;
        completedTasksEl.textContent = todos.filter((t) => t.completed).length;
      }

      // Utilit√°rios
      function formatDate(dateString) {
        const date = new Date(dateString);
        return (
          date.toLocaleDateString("pt-BR") +
          " " +
          date.toLocaleTimeString("pt-BR", {
            hour: "2-digit",
            minute: "2-digit",
          })
        );
      }

      function formatFileSize(bytes) {
        if (bytes === 0) return "0 Bytes";
        const k = 1024;
        const sizes = ["Bytes", "KB", "MB", "GB"];
        const i = Math.floor(Math.log(bytes) / Math.log(k));
        return parseFloat((bytes / Math.pow(k, i)).toFixed(2)) + " " + sizes[i];
      }
    </script>
  </body>
</html>
